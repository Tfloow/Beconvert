{% extends "base.html" %}

{% block head %}
<title>{{ _("Invoice - Under Construction") }}</title>
{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[70vh]">
    <div class="bg-white shadow-lg rounded-2xl p-10 text-center max-w-lg">
        <div class="text-6xl mb-4">ðŸš§</div>
        <h1 class="text-2xl font-bold text-gray-800 mb-2">
            {{ _("This page is under construction") }}
        </h1>
        <p class="text-gray-600 mb-4">
            {{ _("Weâ€™re working hard to bring you this feature soon. Please check back later!") }}
        </p>
        <a href="/" class="inline-block bg-blue-600 text-white font-medium py-2 px-4 rounded-lg shadow hover:bg-blue-700 transition">
            {{ _("Back to Home") }}
        </a>
    </div>
</div>

{% if warning %}
    <div id="errorRibbon" 
        class="bg-red-600 text-white text-center py-2 px-4 rounded-md mb-4">
        {{ _('You must upload a file before converting') }}
    </div>
{% endif %}

{% if error %}
    <div id="warningRibbon" 
        class="bg-yellow-600 text-white text-center py-2 px-4 rounded-md mb-4">
        <b>{{ _('Error or Unsupported conversion.') }}</b> 
        <p>{{ _('Please check the supported conversions in the guide.') }}</p>
    </div>
{% endif %}

    <!-- Upload Form -->
    <div class="bg-white p-8 rounded-lg shadow-md border border-gray-200 mb-10">
    <form id="uploadForm" action="/invoice/create" method="post" enctype="multipart/form-data"
            class="flex flex-col sm:flex-row items-center gap-4">
        <input id="fileInput" type="file" name="file"
            accept=".csv,.txt,.xlsx,.md,.yaml,.yml"
            class="border rounded-md px-3 py-2 w-full sm:w-auto focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button  id="convert-btn" type="submit"
                class="relative flex items-center justify-center bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow-md hover:bg-blue-700 transition disabled:opacity-70 disabled:cursor-not-allowed">
        <span id="convert-text">{{ _('Create an invoice') }}</span>
        <!-- Hidden spinner -->
        <svg id="convert-spinner" class="animate-spin h-5 w-5 ml-2 hidden text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
        </button>
    </form>

<!-- PDF Preview -->
{% if ID %}
    <div class="flex justify-center">
        <iframe 
            src="{{ url_for('uploaded_file', ID=ID, filename='output.pdf') }}" 
            width="100%" 
            height="600" 
            class="border rounded-lg shadow-lg"
        ></iframe>
    </div>
{% else %}
    <div class="flex justify-center">
        <div class="w-full h-60 flex items-center justify-center border-2 border-dashed rounded-lg shadow-sm bg-gray-50 text-gray-500">
            <p class="text-lg font-medium">Your invoice will appear here after creation</p>
        </div>
    </div>
{% endif %}


{% endblock %}

{% block script %}
<script>
  document.getElementById("convert-btn").addEventListener("click", function () {
    const btn = this;
    const text = document.getElementById("convert-text");
    const spinner = document.getElementById("convert-spinner");

    // Disable button and show spinner
    //btn.disabled = true;
    text.textContent = "{{ _('Converting...') }}"; // optional
    spinner.classList.remove("hidden");
  });
</script>
{% endblock %}
